<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>파크노원 - 노원구 공영주차장 안내</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { color: #2c3e50; }
  .parking-list { display: flex; flex-wrap: wrap; gap: 20px; }
  .parking-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; width: 300px; box-shadow: 1px 1px 5px #ccc; }
  .parking-card h2 { margin-top: 0; }
  .status { font-weight: bold; }
  .status.open { color: green; }
  .status.closed { color: red; }
  #map { width: 100%; height: 400px; margin-top: 20px; border: 1px solid #ccc; }
  label, select, input { margin: 5px 0; display: block; }
  .fee-result { margin-top: 10px; font-weight: bold; }
</style>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=367726c3ab6ff65fcc71d1e19b3e9bb3"></script>
</head>
<body>

<h1>파크노원 - 노원구 공영주차장 안내</h1>

<div class="parking-list">
  <div class="parking-card" id="p1">
    <h2>공릉동 공영주차장</h2>
    <p>운영시간:</p>
    <ul>
      <li>평일: 09:00 ~ 19:00</li>
      <li>주말: 09:00 ~ 19:00</li>
    </ul>
    <p>요금: 5분당 250원</p>
    <p>상태: <span class="status">불러오는 중...</span></p>
  </div>

  <div class="parking-card" id="p2">
    <h2>석계역 공영주차장</h2>
    <p>운영시간:</p>
    <ul>
      <li>평일/주말: 00:00 ~ 24:00</li>
    </ul>
    <p>요금: 5분당 260원</p>
    <p>상태: <span class="status">불러오는 중...</span></p>
  </div>

  <div class="parking-card" id="p3">
    <h2>중계근린공원</h2>
    <p>운영시간:</p>
    <ul>
      <li>평일: 09:00 ~ 19:00</li>
      <li>토요일: 09:00 ~ 18:00</li>
      <li>일요일/공휴일: 자유주차</li>
    </ul>
    <p>요금: 5분당 250원</p>
    <p>상태: <span class="status">불러오는 중...</span></p>
  </div>

  <div class="parking-card" id="p4">
    <h2>등나무근린공원</h2>
    <p>운영시간:</p>
    <ul>
      <li>평일: 10:30 ~ 21:00</li>
      <li>토요일: 10:30 ~ 22:00</li>
      <li>일요일: 00:00 ~ 24:00</li>
    </ul>
    <p>요금: 5분당 250원</p>
    <p>상태: <span class="status">불러오는 중...</span></p>
  </div>
</div>

<h2>주차요금 계산기</h2>
<label for="select-parking">주차장 선택:</label>
<select id="select-parking">
  <option value="p1">공릉동 공영주차장</option>
  <option value="p2">석계역 공영주차장</option>
  <option value="p3">중계근린공원</option>
  <option value="p4">등나무근린공원</option>
</select>

<label for="input-time">주차 시간 (분):</label>
<input type="number" id="input-time" min="0" placeholder="예: 60" />

<button id="calc-fee">요금 계산</button>

<div class="fee-result" id="fee-result"></div>

<div id="map"></div>

<script>
const parkingData = {
  p1: { 
    coords: { lat: 37.61875, lng: 127.0773 }, 
    feePerUnit: 250, 
    unitTime: 5,
    schedule: {
      weekday: { open: "09:00", close: "19:00" },
      weekend: { open: "09:00", close: "19:00" }
    }
  },
  p2: { 
    coords: { lat: 37.61855, lng: 127.0612 }, 
    feePerUnit: 260, 
    unitTime: 5,
    schedule: {
      weekday: { open: "00:00", close: "24:00" },
      weekend: { open: "00:00", close: "24:00" }
    }
  },
  p3: { 
    coords: { lat: 37.6361, lng: 127.0731 }, 
    feePerUnit: 250, 
    unitTime: 5,
    schedule: {
      weekday: { open: "09:00", close: "19:00" },
      saturday: { open: "09:00", close: "18:00" },
      sundayHoliday: "free"
    }
  },
  p4: { 
    coords: { lat: 37.6322, lng: 127.0702 }, 
    feePerUnit: 250, 
    unitTime: 5,
    schedule: {
      weekday: { open: "10:30", close: "21:00" },
      saturday: { open: "10:30", close: "22:00" },
      sunday: { open: "00:00", close: "24:00" }
    }
  }
};

function updateStatus(card, data) {
  const s = card.querySelector(".status");
  const now = new Date();
  const day = now.getDay(); // 0:일,1:월, ...6:토
  
  let openTime, closeTime;
  
  if (data.schedule) {
    if (day >= 1 && day <= 5) {  // 월~금
      openTime = data.schedule.weekday.open;
      closeTime = data.schedule.weekday.close;
    } else if (day === 6) { // 토요일
      if (data.schedule.saturday) {
        openTime = data.schedule.saturday.open;
        closeTime = data.schedule.saturday.close;
      } else {
        openTime = data.schedule.weekend ? data.schedule.weekend.open : data.schedule.weekday.open;
        closeTime = data.schedule.weekend ? data.schedule.weekend.close : data.schedule.weekday.close;
      }
    } else if (day === 0) { // 일요일
      if (data.schedule.sunday) {
        openTime = data.schedule.sunday.open;
        closeTime = data.schedule.sunday.close;
      } else if (data.schedule.sundayHoliday === "free") {
        s.textContent = "자유주차";
        s.className = "status open";
        return;
      } else {
        openTime = data.schedule.weekend ? data.schedule.weekend.open : data.schedule.weekday.open;
        closeTime = data.schedule.weekend ? data.schedule.weekend.close : data.schedule.weekday.close;
      }
    }
  } else {
    openTime = data.open;
    closeTime = data.close;
  }
  
  const [oh, om] = openTime.split(':').map(Number);
  const [ch, cm] = closeTime.split(':').map(Number);
  
  const open = new Date(now);
  open.setHours(oh, om, 0, 0);
  const close = new Date(now);
  if (ch === 24) {
    close.setHours(23, 59, 59, 999);
  } else {
    close.setHours(ch, cm, 59, 999);
  }
  
  const isOpen = now >= open && now <= close;
  s.textContent = isOpen ? "운영중" : "운영종료";
  s.className = `status ${isOpen ? "open" : "closed"}`;
}

function initMap() {
  const map = new kakao.maps.Map(document.getElementById("map"), {
    center: new kakao.maps.LatLng(37.63, 127.07),
    level: 13,
  });

  for (const key in parkingData) {
    const data = parkingData[key];
    const marker = new kakao.maps.Marker({
      map: map,
      position: new kakao.maps.LatLng(data.coords.lat, data.coords.lng),
      title: key,
    });
  }
}

function calculateFee(parkingId, minutes) {
  const data = parkingData[parkingId];
  if (!data) return 0;
  if (minutes <= 0) return 0;
  const units = Math.ceil(minutes / data.unitTime);
  return units * data.feePerUnit;
}

document.addEventListener("DOMContentLoaded", () => {
  // 상태 업데이트
  for (const key in parkingData) {
    const card = document.getElementById(key);
    updateStatus(card, parkingData[key]);
  }

  initMap();

  const select = document.getElementById("select-parking");
  const inputTime = document.getElementById("input-time");
  const btnCalc = document.getElementById("calc-fee");
  const feeResult = document.getElementById("fee-result");

  btnCalc.addEventListener("click", () => {
    const parkingId = select.value;
    const minutes = parseInt(inputTime.value, 10);
    if (isNaN(minutes) || minutes < 0) {
      feeResult.textContent = "주차 시간을 올바르게 입력하세요.";
      return;
    }
    const fee = calculateFee(parkingId, minutes);
    feeResult.textContent = `주차 요금: ${fee.toLocaleString()}원`;
  });
});
</script>

</body>
</html>
